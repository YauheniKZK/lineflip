import{d as F,r as u,b as L,e as P,w as U,c as S,F as W,f as M,g as k,h as $,v as q,i as K,o as V,a as j}from"./index-X--NQMg7.js";const J={style:{"margin-bottom":"8px"}},v=400,c=600,d=10,w=40,I=3,Q=5,Z=F({__name:"CanvasBlock",setup(z){const O=u("#DED3C4"),E=u("#555879"),f=u(450),y=u([{type:"down",startX:50,startY:0,width:15,length:80},{type:"left",startX:430,startY:80,width:60,length:500},{type:"down",startX:150,startY:130,width:15,length:100},{type:"left",startX:250,startY:200,width:80,length:500},{type:"down",startX:50,startY:280,width:15,length:40},{type:"left",startX:350,startY:320,width:80,length:300},{type:"down",startX:320,startY:400,width:15,length:60}]),H=u([{flipTo:"horizontal",autoBounce:!0},{flipTo:"vertical"},{flipTo:"vertical",direction:"right"},{flipTo:"vertical"},{flipTo:"vertical",direction:"left"},{flipTo:"vertical"},{flipTo:"vertical",direction:"right"},{flipTo:"vertical"}]),t=L({x:0,y:0,phase:"idle",hDir:1,autoBounce:!1,verticalDriftOnly:!1,win:!1}),X=u(0);function Y(){t.x=0,t.y=0,t.phase="idle",t.hDir=1,t.autoBounce=!1,t.verticalDriftOnly=!1,t.win=!1,X.value=0}function R(){if(t.phase==="ended"){Y();return}const e=H.value[X.value];e&&(e.direction==="left"&&(t.hDir=-1),e.direction==="right"&&(t.hDir=1),e.flipTo==="horizontal"?(t.phase="horizontal",t.autoBounce=!!e.autoBounce):e.flipTo==="vertical"&&e.direction?(t.phase="verticalDrift",t.verticalDriftOnly=!0):e.flipTo==="vertical"?t.phase="verticalFall":e.direction&&(t.phase="horizontal",t.autoBounce=!1),X.value++)}function C(){G(),A(),requestAnimationFrame(C)}function G(){const e=v-w,a=v-d,o=c-f.value;function B(l,s,b,g){const m=Math.max(s,o);for(let r=Math.floor(l);r<l+b;r++)for(let p=Math.floor(m);p<s+g;p++){let D=!1;for(const i of y.value){let h,x,_,T;if(i.type==="down"?(h=i.startX,x=o+i.startY,_=i.width,T=i.length):i.type==="left"?(h=i.startX-i.length,x=o+i.startY,_=i.length,T=i.width):(h=i.startX,x=o+i.startY,_=i.length,T=i.width),r>=h&&r<h+_&&p>=x&&p<x+T){D=!0;break}}if(!D)return!1}return!0}if(t.phase==="horizontal"){t.x+=I*t.hDir,t.autoBounce?t.x<=0?(t.x=0,t.hDir=1):t.x>=e&&(t.x=e,t.hDir=-1):t.x=Math.max(0,Math.min(e,t.x));const l=t.y,s=d;l+s>o&&(B(t.x,l,w,s)||(t.phase="ended",t.win=!1));return}if(t.phase==="verticalDrift"){t.x=Math.max(0,Math.min(a,t.x+I*t.hDir));const l=t.y,s=w;if(l+s>o&&!B(t.x,l,d,s)){t.phase="ended",t.win=!1;return}(t.x===0||t.x===a)&&(t.phase="ended",t.win=!0);return}if(t.phase==="verticalFall"){const l=t.x,s=l+d;if(y.value.some(r=>{if(r.type!=="down")return!1;const p=r.startX,D=r.startX+r.width,i=o+r.startY,h=i+r.length;return l>=p&&s<=D&&i<=o&&h>=c})){t.phase="ended",t.win=!0;return}if(t.y+=Q,t.y>c){t.phase="ended",t.win=!0;return}const g=t.y,m=w;g+m>o&&(B(t.x,g,d,m)||(t.phase="ended",t.win=!1))}}function A(){n.clearRect(0,0,v,c),n.fillStyle=E.value,n.fillRect(0,c-f.value,v,f.value),n.save(),n.globalCompositeOperation="destination-out",y.value.forEach(e=>{const a=c-f.value+e.startY;e.type==="down"?n.clearRect(e.startX,a,e.width,e.length):e.type==="left"&&n.clearRect(e.startX-e.length,a,e.length,e.width)}),n.restore(),n.save(),n.translate(t.x,t.y),n.fillStyle=O.value,t.phase==="horizontal"||t.phase==="idle"?n.fillRect(0,0,w,d):n.fillRect(0,0,d,w),n.restore(),t.phase==="ended"&&(n.fillStyle=t.win?"green":"red",n.font="24px sans-serif",n.textAlign="center",n.fillText(t.win?"You Win!":"Game Over",v/2,c/2))}let n;const N=u();return P(()=>{n=N.value.getContext("2d"),Y(),C()}),U([f,y,H],Y,{deep:!0}),(e,a)=>(V(),S(W,null,[M("div",J,[a[1]||(a[1]=k(" Высота земли: ")),$(M("input",{type:"number","onUpdate:modelValue":a[0]||(a[0]=o=>f.value=o),style:{width:"60px"}},null,512),[[q,f.value,void 0,{number:!0}]]),a[2]||(a[2]=k("px "))]),M("canvas",{ref_key:"canvas",ref:N,onMousedown:R,onTouchstart:K(R,["prevent"]),width:v,height:c,style:{border:"1px solid #ccc","touch-action":"none",display:"block"}},null,544)],64))}}),tt={class:"px-4 pt-4"},nt=F({__name:"Home",setup(z){return(O,E)=>(V(),S("div",tt,[j(Z)]))}});export{nt as default};
