import{d as F,r as h,b as L,e as P,w as U,c as S,F as W,f as M,g as k,h as $,v as q,i as K,o as V,a as j}from"./index-DGNUkXx1.js";const J={style:{"margin-bottom":"8px"}},v=400,c=600,d=10,w=40,I=3,Q=5,Z=F({__name:"CanvasBlock",setup(z){const O=h("#DED3C4"),E=h("#555879"),f=h(450),y=h([{type:"down",startX:50,startY:0,width:15,length:80},{type:"left",startX:430,startY:80,width:60,length:500},{type:"down",startX:150,startY:130,width:15,length:100},{type:"left",startX:250,startY:200,width:80,length:500},{type:"down",startX:50,startY:280,width:15,length:40},{type:"left",startX:350,startY:320,width:80,length:300},{type:"down",startX:320,startY:400,width:15,length:60}]),H=h([{flipTo:"horizontal",autoBounce:!0},{flipTo:"vertical"},{flipTo:"vertical",direction:"right"},{flipTo:"vertical"},{flipTo:"vertical",direction:"left"},{flipTo:"vertical"}]),t=L({x:0,y:0,phase:"idle",hDir:1,autoBounce:!1,verticalDriftOnly:!1,win:!1}),X=h(0);function Y(){t.x=0,t.y=0,t.phase="idle",t.hDir=1,t.autoBounce=!1,t.verticalDriftOnly=!1,t.win=!1,X.value=0}function R(){if(t.phase==="ended"){Y();return}const e=H.value[X.value];e&&(e.direction==="left"&&(t.hDir=-1),e.direction==="right"&&(t.hDir=1),e.flipTo==="horizontal"?(t.phase="horizontal",t.autoBounce=!!e.autoBounce):e.flipTo==="vertical"&&e.direction?(t.phase="verticalDrift",t.verticalDriftOnly=!0):e.flipTo==="vertical"?t.phase="verticalFall":e.direction&&(t.phase="horizontal",t.autoBounce=!1),X.value++)}function C(){G(),A(),requestAnimationFrame(C)}function G(){const e=v-w,i=v-d,o=c-f.value;function B(l,r,b,g){const m=Math.max(r,o);for(let s=Math.floor(l);s<l+b;s++)for(let p=Math.floor(m);p<r+g;p++){let D=!1;for(const a of y.value){let u,x,_,T;if(a.type==="down"?(u=a.startX,x=o+a.startY,_=a.width,T=a.length):a.type==="left"?(u=a.startX-a.length,x=o+a.startY,_=a.length,T=a.width):(u=a.startX,x=o+a.startY,_=a.length,T=a.width),s>=u&&s<u+_&&p>=x&&p<x+T){D=!0;break}}if(!D)return!1}return!0}if(t.phase==="horizontal"){t.x+=I*t.hDir,t.autoBounce?t.x<=0?(t.x=0,t.hDir=1):t.x>=e&&(t.x=e,t.hDir=-1):t.x=Math.max(0,Math.min(e,t.x));const l=t.y,r=d;l+r>o&&(B(t.x,l,w,r)||(t.phase="ended",t.win=!1));return}if(t.phase==="verticalDrift"){t.x=Math.max(0,Math.min(i,t.x+I*t.hDir));const l=t.y,r=w;if(l+r>o&&!B(t.x,l,d,r)){t.phase="ended",t.win=!1;return}(t.x===0||t.x===i)&&(t.phase="ended",t.win=!0);return}if(t.phase==="verticalFall"){const l=t.x,r=l+d;if(y.value.some(s=>{if(s.type!=="down")return!1;const p=s.startX,D=s.startX+s.width,a=o+s.startY,u=a+s.length;return l>=p&&r<=D&&a<=o&&u>=c})){t.phase="ended",t.win=!0;return}if(t.y+=Q,t.y>c){t.phase="ended",t.win=!0;return}const g=t.y,m=w;g+m>o&&(B(t.x,g,d,m)||(t.phase="ended",t.win=!1))}}function A(){n.clearRect(0,0,v,c),n.fillStyle=E.value,n.fillRect(0,c-f.value,v,f.value),n.save(),n.globalCompositeOperation="destination-out",y.value.forEach(e=>{const i=c-f.value+e.startY;e.type==="down"?n.clearRect(e.startX,i,e.width,e.length):e.type==="left"&&n.clearRect(e.startX-e.length,i,e.length,e.width)}),n.restore(),n.save(),n.translate(t.x,t.y),n.fillStyle=O.value,t.phase==="horizontal"||t.phase==="idle"?n.fillRect(0,0,w,d):n.fillRect(0,0,d,w),n.restore(),t.phase==="ended"&&(n.fillStyle=t.win?"green":"red",n.font="24px sans-serif",n.textAlign="center",n.fillText(t.win?"You Win!":"Game Over",v/2,c/2))}let n;const N=h();return P(()=>{n=N.value.getContext("2d"),Y(),C()}),U([f,y,H],Y,{deep:!0}),(e,i)=>(V(),S(W,null,[M("div",J,[i[1]||(i[1]=k(" Высота земли: ")),$(M("input",{type:"number","onUpdate:modelValue":i[0]||(i[0]=o=>f.value=o),style:{width:"60px"}},null,512),[[q,f.value,void 0,{number:!0}]]),i[2]||(i[2]=k("px "))]),M("canvas",{ref_key:"canvas",ref:N,onMousedown:R,onTouchstart:K(R,["prevent"]),width:v,height:c,style:{border:"1px solid #ccc","touch-action":"none",display:"block"}},null,544)],64))}}),tt={class:"px-4 pt-4"},nt=F({__name:"Home",setup(z){return(O,E)=>(V(),S("div",tt,[j(Z)]))}});export{nt as default};
