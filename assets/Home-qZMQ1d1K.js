import{d as O,e as y,f as A,g as G,h as P,b as R,F as U,i as X,j as I,k as W,v as $,l as j,o as S,a as q}from"./index-DpKGrpCt.js";const K={style:{"margin-bottom":"8px"}},p=400,f=600,h=10,v=80,N=3,L=5,J=O({__name:"CanvasBlock",setup(V){const c=y(300),x=y([{type:"down",startX:50,startY:0,width:20,length:100},{type:"left",startX:430,startY:100,width:100,length:500},{type:"down",startX:150,startY:150,width:20,length:300}]),Y=y([{flipTo:"horizontal",autoBounce:!0},{flipTo:"vertical"},{flipTo:"vertical",direction:"right"},{flipTo:"vertical"}]),t=A({x:0,y:0,phase:"idle",hDir:1,autoBounce:!1,verticalDriftOnly:!1,win:!1}),B=y(0);function M(){t.x=0,t.y=0,t.phase="idle",t.hDir=1,t.autoBounce=!1,t.verticalDriftOnly=!1,t.win=!1,B.value=0}function k(){if(t.phase==="ended"){M();return}const e=Y.value[B.value];e&&(e.direction==="left"&&(t.hDir=-1),e.direction==="right"&&(t.hDir=1),e.flipTo==="horizontal"?(t.phase="horizontal",t.autoBounce=!!e.autoBounce):e.flipTo==="vertical"&&e.direction?(t.phase="verticalDrift",t.verticalDriftOnly=!0):e.flipTo==="vertical"?t.phase="verticalFall":e.direction&&(t.phase="horizontal",t.autoBounce=!1),B.value++)}function E(){z(),C(),requestAnimationFrame(E)}function z(){const e=p-v,a=p-h,o=f-c.value;function H(l,r,F,m){const g=Math.max(r,o);for(let s=Math.floor(l);s<l+F;s++)for(let d=Math.floor(g);d<r+m;d++){let D=!1;for(const i of x.value){let u,w,_,T;if(i.type==="down"?(u=i.startX,w=o+i.startY,_=i.width,T=i.length):i.type==="left"?(u=i.startX-i.length,w=o+i.startY,_=i.length,T=i.width):(u=i.startX,w=o+i.startY,_=i.length,T=i.width),s>=u&&s<u+_&&d>=w&&d<w+T){D=!0;break}}if(!D)return!1}return!0}if(t.phase==="horizontal"){t.x+=N*t.hDir,t.autoBounce?t.x<=0?(t.x=0,t.hDir=1):t.x>=e&&(t.x=e,t.hDir=-1):t.x=Math.max(0,Math.min(e,t.x));const l=t.y,r=h;l+r>o&&(H(t.x,l,v,r)||(t.phase="ended",t.win=!1));return}if(t.phase==="verticalDrift"){t.x=Math.max(0,Math.min(a,t.x+N*t.hDir));const l=t.y,r=v;if(l+r>o&&!H(t.x,l,h,r)){t.phase="ended",t.win=!1;return}(t.x===0||t.x===a)&&(t.phase="ended",t.win=!0);return}if(t.phase==="verticalFall"){const l=t.x,r=l+h;if(x.value.some(s=>{if(s.type!=="down")return!1;const d=s.startX,D=s.startX+s.width,i=o+s.startY,u=i+s.length;return l>=d&&r<=D&&i<=o&&u>=f})){t.phase="ended",t.win=!0;return}if(t.y+=L,t.y>f){t.phase="ended",t.win=!0;return}const m=t.y,g=v;m+g>o&&(H(t.x,m,h,g)||(t.phase="ended",t.win=!1))}}function C(){n.clearRect(0,0,p,f),n.fillStyle="#654321",n.fillRect(0,f-c.value,p,c.value),n.save(),n.globalCompositeOperation="destination-out",x.value.forEach(e=>{const a=f-c.value+e.startY;e.type==="down"?n.clearRect(e.startX,a,e.width,e.length):e.type==="left"&&n.clearRect(e.startX-e.length,a,e.length,e.width)}),n.restore(),n.save(),n.translate(t.x,t.y),n.fillStyle="#f00",t.phase==="horizontal"||t.phase==="idle"?n.fillRect(0,0,v,h):n.fillRect(0,0,h,v),n.restore(),t.phase==="ended"&&(n.fillStyle=t.win?"green":"red",n.font="24px sans-serif",n.textAlign="center",n.fillText(t.win?"You Win!":"Game Over",p/2,f/2))}let n;const b=y();return G(()=>{n=b.value.getContext("2d"),M(),E()}),P([c,x,Y],M,{deep:!0}),(e,a)=>(S(),R(U,null,[X("div",K,[a[1]||(a[1]=I(" Высота земли: ")),W(X("input",{type:"number","onUpdate:modelValue":a[0]||(a[0]=o=>c.value=o),style:{width:"60px"}},null,512),[[$,c.value,void 0,{number:!0}]]),a[2]||(a[2]=I("px "))]),X("canvas",{ref_key:"canvas",ref:b,onMousedown:k,onTouchstart:j(k,["prevent"]),width:p,height:f,style:{border:"1px solid #ccc","touch-action":"none",display:"block"}},null,544)],64))}}),Q={class:"px-4 pt-4"},tt=O({__name:"Home",setup(V){return(c,x)=>(S(),R("div",Q,[q(J)]))}});export{tt as default};
