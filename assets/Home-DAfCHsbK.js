import{d as F,r as h,b as L,e as P,w as U,c as S,F as W,f as X,g as k,h as $,v as q,i as K,o as V,a as j}from"./index-BV3FY5TX.js";const J={style:{"margin-bottom":"8px"}},v=400,c=600,d=10,x=40,I=3,Q=5,Z=F({__name:"CanvasBlock",setup(z){const Y=h("#DED3C4"),E=h("#555879"),f=h(450),y=h([{type:"down",startX:50,startY:0,width:20,length:100},{type:"left",startX:430,startY:100,width:60,length:500},{type:"down",startX:150,startY:150,width:20,length:150},{type:"left",startX:250,startY:300,width:80,length:500},{type:"down",startX:50,startY:350,width:20,length:150}]),H=h([{flipTo:"horizontal",autoBounce:!0},{flipTo:"vertical"},{flipTo:"vertical",direction:"right"},{flipTo:"vertical"},{flipTo:"vertical",direction:"left"},{flipTo:"vertical"}]),t=L({x:0,y:0,phase:"idle",hDir:1,autoBounce:!1,verticalDriftOnly:!1,win:!1}),B=h(0);function M(){t.x=0,t.y=0,t.phase="idle",t.hDir=1,t.autoBounce=!1,t.verticalDriftOnly=!1,t.win=!1,B.value=0}function R(){if(t.phase==="ended"){M();return}const e=H.value[B.value];e&&(e.direction==="left"&&(t.hDir=-1),e.direction==="right"&&(t.hDir=1),e.flipTo==="horizontal"?(t.phase="horizontal",t.autoBounce=!!e.autoBounce):e.flipTo==="vertical"&&e.direction?(t.phase="verticalDrift",t.verticalDriftOnly=!0):e.flipTo==="vertical"?t.phase="verticalFall":e.direction&&(t.phase="horizontal",t.autoBounce=!1),B.value++)}function C(){G(),A(),requestAnimationFrame(C)}function G(){const e=v-x,a=v-d,o=c-f.value;function O(l,r,b,g){const m=Math.max(r,o);for(let s=Math.floor(l);s<l+b;s++)for(let p=Math.floor(m);p<r+g;p++){let D=!1;for(const i of y.value){let u,w,_,T;if(i.type==="down"?(u=i.startX,w=o+i.startY,_=i.width,T=i.length):i.type==="left"?(u=i.startX-i.length,w=o+i.startY,_=i.length,T=i.width):(u=i.startX,w=o+i.startY,_=i.length,T=i.width),s>=u&&s<u+_&&p>=w&&p<w+T){D=!0;break}}if(!D)return!1}return!0}if(t.phase==="horizontal"){t.x+=I*t.hDir,t.autoBounce?t.x<=0?(t.x=0,t.hDir=1):t.x>=e&&(t.x=e,t.hDir=-1):t.x=Math.max(0,Math.min(e,t.x));const l=t.y,r=d;l+r>o&&(O(t.x,l,x,r)||(t.phase="ended",t.win=!1));return}if(t.phase==="verticalDrift"){t.x=Math.max(0,Math.min(a,t.x+I*t.hDir));const l=t.y,r=x;if(l+r>o&&!O(t.x,l,d,r)){t.phase="ended",t.win=!1;return}(t.x===0||t.x===a)&&(t.phase="ended",t.win=!0);return}if(t.phase==="verticalFall"){const l=t.x,r=l+d;if(y.value.some(s=>{if(s.type!=="down")return!1;const p=s.startX,D=s.startX+s.width,i=o+s.startY,u=i+s.length;return l>=p&&r<=D&&i<=o&&u>=c})){t.phase="ended",t.win=!0;return}if(t.y+=Q,t.y>c){t.phase="ended",t.win=!0;return}const g=t.y,m=x;g+m>o&&(O(t.x,g,d,m)||(t.phase="ended",t.win=!1))}}function A(){n.clearRect(0,0,v,c),n.fillStyle=E.value,n.fillRect(0,c-f.value,v,f.value),n.save(),n.globalCompositeOperation="destination-out",y.value.forEach(e=>{const a=c-f.value+e.startY;e.type==="down"?n.clearRect(e.startX,a,e.width,e.length):e.type==="left"&&n.clearRect(e.startX-e.length,a,e.length,e.width)}),n.restore(),n.save(),n.translate(t.x,t.y),n.fillStyle=Y.value,t.phase==="horizontal"||t.phase==="idle"?n.fillRect(0,0,x,d):n.fillRect(0,0,d,x),n.restore(),t.phase==="ended"&&(n.fillStyle=t.win?"green":"red",n.font="24px sans-serif",n.textAlign="center",n.fillText(t.win?"You Win!":"Game Over",v/2,c/2))}let n;const N=h();return P(()=>{n=N.value.getContext("2d"),M(),C()}),U([f,y,H],M,{deep:!0}),(e,a)=>(V(),S(W,null,[X("div",J,[a[1]||(a[1]=k(" Высота земли: ")),$(X("input",{type:"number","onUpdate:modelValue":a[0]||(a[0]=o=>f.value=o),style:{width:"60px"}},null,512),[[q,f.value,void 0,{number:!0}]]),a[2]||(a[2]=k("px "))]),X("canvas",{ref_key:"canvas",ref:N,onMousedown:R,onTouchstart:K(R,["prevent"]),width:v,height:c,style:{border:"1px solid #ccc","touch-action":"none",display:"block"}},null,544)],64))}}),tt={class:"px-4 pt-4"},nt=F({__name:"Home",setup(z){return(Y,E)=>(V(),S("div",tt,[j(Z)]))}});export{nt as default};
